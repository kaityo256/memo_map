Japanese/ [English](README.md)

# メモ化のために使うハッシュ

## 概要

何かのキーに対して値を計算するのだが、その計算が重いのでキャッシュしたい。
しかし、大量に計算するため、際限なくキャッシュはできない。
そこで、最初に指定したサイズに到達したら、値の大きなものだけ残して
データを半分にするようなハッシュを作った。

## 使い方

`memo_map.hpp`をインクルードするだけで使えます。普通のメモ化と同様に、何か`key`に対する値を計算する関数`calculate_value_of`を、以下のようにラップして使います。

```
memo_map<int, int> m(100000);

int
func(int key){
  if(m.has_key(key))return m[key];
  else return calculate_value_of(key);
}
```

使い方は`std::unordered_map`と全く同じですが、コンストラクタで最大サイズを取り、そのサイズを超えて要素を保持しません。最大サイズに到達すると、保持するデータを半分にします。その時、値の大きさでソートし、値が大きいものだけ半分残すようにします。

## サンプル

サンプルとして、`std::string`をキーに、値を`int`にした`test_int.cpp`と、
`std::string`をキーに、値を`double`にした`test_double.cpp`を用意しました。
それぞれ実行すると以下のような結果を出力します。

キーが文字列、値が整数の例。

    $ make
    $ ./test_int
    Input Data
    test000->082
    test001->013
    test002->091
    test003->084
    test004->012
    test005->097
    test006->092
    test007->022
    test008->063
    test009->031
    test010->009
    test011->055
    test012->028
    test013->019
    test014->055
    test015->100
    test016->096
    test017->100
    test018->097
    test019->097
    Cached Data
    test000->082
    test003->084
    test002->091
    test006->092
    test016->096
    test005->097
    test019->097
    test018->097
    test017->100
    test015->100    

キーが文字列、値が浮動小数の例。

    $ make
    $ ./test_double
    Input Data
    test000->0.1355
    test001->0.8350
    test002->0.9689
    test003->0.2210
    test004->0.3082
    test005->0.5472
    test006->0.1884
    test007->0.9929
    test008->0.9965
    test009->0.9677
    test010->0.7258
    test011->0.9811
    test012->0.1099
    test013->0.7981
    test014->0.2970
    test015->0.0048
    test016->0.1125
    test017->0.6398
    test018->0.8784
    test019->0.0000
    Cached Data
    test019->0.0000
    test010->0.7258
    test013->0.7981
    test001->0.8350
    test018->0.8784
    test009->0.9677
    test002->0.9689
    test011->0.9811
    test017->0.6398
    test007->0.9929
    test008->0.9965

サンプルでは最大要素数を20に設定してあり、20個設定すると、その時点での値が大きいものを10個だけ残しますが、その後一個追加されるため、11個表示されます。この例では`test019->0.0000`のペアは最後に追加されたために残っています。
